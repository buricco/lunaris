#	$OpenBSD: Makefile,v 1.10 2010/01/04 17:50:36 deraadt Exp $
#
# C Shell with process control; VM/UNIX VAX Makefile
# Bill Joy UC Berkeley; Jim Kulp IIASA, Austria
#
# To profile, put -DPROF in DEFS and -pg in CFLAGS, and recompile.

PROG=	csh
DFLAGS=-D_GNU_SOURCE
CFLAGS+= -I. ${DFLAGS}
OBJS=	alloc.o char.o const.o csh.o dir.o dol.o error.o exec.o exp.o file.o \
	func.o glob.o hist.o init.o lex.o misc.o parse.o proc.o \
	sem.o set.o str.o time.o vis.o strlcpy.o strtonum.o reallocarray.o \
	signames.o

$(PROG):	const.h error.h $(OBJS)
	$(CC) -o $(PROG) $(OBJS)
	strip -s -R .note -R .comment csh
	size csh

install:
	install -o root -g root -m 555 csh /bin/csh

%.o:	%.c
	$(CC) $(CFLAGS) -c -o $@ $<

clean:
	rm -f *.o error.h const.h csh

const.h: error.h

error.h: error.c
	@rm -f $@
	@echo '/* Do not edit this file, make creates it. */' > $@
	@echo '#ifndef _h_sh_err' >> $@
	@echo '#define _h_sh_err' >> $@
	egrep 'ERR_' ./$*.c | egrep '^#define' >> $@
	@echo '#endif /* _h_sh_err */' >> $@

const.h: const.c
	@rm -f $@
	@echo '/* Do not edit this file, make creates it. */' > $@
	${CC} -E ${CFLAGS} ./$*.c | egrep 'Char STR' | \
	    sed -e 's/Char \([a-zA-Z0-9_]*\)\(.*\)/extern Char \1[];/' | \
	    sort >> $@

